<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>é”å®š | æ­¦æ±‰</title>
    <style>
        /* --- 1. å…¨å±€è®¾ç½® --- */
        :root {
            --bg-color: #050505;
            --text-color: #e0e0e0;
            --font-stack: "Songti SC", "Noto Serif SC", "SimSun", serif;
            --accent-red: #cc2222;
        }

        body {
            margin: 0; background-color: var(--bg-color); color: var(--text-color);
            font-family: var(--font-stack); 
            overflow: hidden; cursor: crosshair;
            height: 100vh; width: 100vw;
            user-select: none; touch-action: none;
        }

        #main-wrapper {
            position: relative; width: 100%; height: 100%;
            animation: fadeInZoom 1.5s cubic-bezier(0.2, 0.8, 0.2, 1) forwards;
        }

        body.is-exiting #main-wrapper {
            transition: all 0.8s ease-in;
            transform: scale(2); opacity: 0; filter: blur(20px);
        }

        /* --- 2. èƒŒæ™¯è£…é¥° --- */
        .layer-bg { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 0; pointer-events: none; opacity: 0.3; }
        .sketch-grid { position: absolute; top: 0; left: 0; width: 100%; height: 100%; opacity: 0.1; }
        .grid-line { stroke: rgba(255,255,255,0.3); stroke-width: 0.5; stroke-dasharray: 100% 0; }

        /* --- 3. åœ°å›¾è§†å£å®¹å™¨ --- */
        .map-container {
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            width: 100vw; height: 100vh; 
            background: #000;
            overflow: hidden;
            z-index: 10;
        }

        /* å¯ç§»åŠ¨å›¾å±‚ (æ­£æ–¹å½¢å®¹å™¨) */
        .map-movable-layer {
            position: absolute;
            top: 0; left: 0;
            transform-origin: 0 0;
            will-change: transform;
            /* åˆå§‹å®½é«˜ï¼Œä¼šè¢«JSè¦†ç›– */
            width: 100%; height: 100%; 
        }

        /* åœ°å›¾å›¾ç‰‡ */
        .map-image {
            display: block;
            pointer-events: none; 
            filter: grayscale(100%) invert(88%) contrast(150%) brightness(0.7);
            opacity: 0.9;
            width: 100%; height: 100%;
            object-fit: fill; 
        }

        /* ğŸ“ å®šä½ç‚¹å®¹å™¨ */
        .map-pin {
            position: absolute;
            display: flex; flex-direction: column; align-items: center;
            z-index: 20; cursor: pointer;
            
            /* ğŸ”¥ğŸ”¥ æ ¸å¿ƒä¿®æ­£ 1ï¼šé”šç‚¹å½’é›¶ ğŸ”¥ğŸ”¥ 
               ä½¿ç”¨ translate(-50%, -50%) ç¡®ä¿æ˜¯çº¢ç‚¹çš„ã€æ­£ä¸­å¿ƒã€‘å¯¹å‡†åæ ‡
               è€Œä¸æ˜¯çº¢ç‚¹çš„å·¦ä¸Šè§’å¯¹å‡†åæ ‡ã€‚
               è¿™æ˜¯è§£å†³å¤šè®¾å¤‡åå·®çš„å…³é”®ï¼
            */
            transform: translate(-50%, -50%) scale(0.5); 
            transform-origin: center center;
            
            /* æ‰©å¤§ç‚¹å‡»çƒ­åŒº */
            padding: 30px; 
            margin: -30px; 
        }
        
        /* çº¢ç‚¹æœ¬ä½“ */
        .pin-dot {
            width: 20px; height: 20px;
            background: var(--accent-red);
            border-radius: 50%;
            box-shadow: 0 0 25px var(--accent-red);
            animation: pulse 1.5s infinite;
            position: relative;
            pointer-events: none; 
        }
        .pin-dot::after {
            content: ''; position: absolute; top: 50%; left: 50%;
            width: 100%; height: 100%;
            border: 2px solid var(--accent-red); border-radius: 50%;
            transform: translate(-50%, -50%);
            animation: ripple 1.5s infinite;
        }

        /* ğŸ“ å°é…’é¦†ä½ç½® (é‡æ–°æ ¡å‡†åçš„åæ ‡) */
        /* å› ä¸ºé”šç‚¹å˜äº†ï¼Œå¯èƒ½éœ€è¦å¾®è°ƒ 0.x% */
        .pin-bistro { top: 59.5%; left: 61%; }

        /* æ–‡å­—æ ‡ç­¾ */
        .pin-label {
            position: absolute; /* æ”¹ä¸ºç»å¯¹å®šä½ï¼Œé˜²æ­¢å½±å“çº¢ç‚¹ä¸­å¿ƒ */
            top: 70px;          /* æ”¾åœ¨çº¢ç‚¹ä¸‹æ–¹ */
            left: 50%;
            transform: translateX(-50%) translateY(10px); /* æ°´å¹³å±…ä¸­ */
            
            font-family: "Courier New", monospace;
            font-size: 1.5rem; 
            color: #fff;
            background: rgba(204, 34, 34, 0.9);
            padding: 4px 10px; border-radius: 4px;
            white-space: nowrap; text-shadow: none; font-weight: bold;
            
            opacity: 0;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            pointer-events: none;
        }

        /* äº¤äº’è§¦å‘æ˜¾ç¤º */
        .map-pin:hover .pin-label { opacity: 1; transform: translateX(-50%) translateY(0); }
        .map-pin:active .pin-label { opacity: 1; transform: translateX(-50%) translateY(0); }

        /* æ‰«æçº¿ */
        .scan-line {
            position: absolute; top: 0; left: 0; width: 100%; height: 2px;
            background: rgba(204, 34, 34, 0.5);
            box-shadow: 0 0 15px rgba(204, 34, 34, 0.8);
            animation: scan 5s linear infinite; z-index: 30; opacity: 0.5; pointer-events: none;
        }

        /* UI */
        .header-ui { position: absolute; top: 5%; width: 100%; text-align: center; z-index: 20; pointer-events: none; }
        h1 { font-size: 1.5rem; letter-spacing: 0.5em; font-weight: 300; text-shadow: 0 0 10px rgba(255,255,255,0.2); margin: 0; }
        .sub-text { font-family: "Courier New", monospace; font-size: 0.8rem; margin-top: 10px; opacity: 0.6; letter-spacing: 0.2em; }
        
        .controls-hint {
            position: absolute; top: 20px; right: 20px; z-index: 50;
            color: rgba(255,255,255,0.4); font-size: 0.7rem; font-family: monospace;
            border: 1px solid rgba(255,255,255,0.2); padding: 5px 10px;
            pointer-events: none;
        }

        .footer-nav { position: absolute; bottom: 5%; width: 100%; text-align: center; z-index: 20; }
        .ghost-btn {
            pointer-events: auto; display: inline-flex; align-items: center; justify-content: center;
            padding: 12px 32px; font-size: 0.85rem; letter-spacing: 0.2em;
            color: rgba(255, 255, 255, 0.6); text-decoration: none;
            border: 1px solid rgba(255, 255, 255, 0.3);
            background: rgba(0,0,0,0.6); backdrop-filter: blur(4px);
            transition: all 0.5s; cursor: pointer; flex-direction: row-reverse;
        }
        .ghost-btn:hover { border-color: #fff; color: #fff; background: rgba(255,255,255,0.1); box-shadow: 0 0 20px rgba(255,255,255,0.2); }
        .arrow-wrapper { width: 0; overflow: hidden; opacity: 0; transform: translateX(5px); transition: 0.4s; display: flex; align-items: center; }
        .ghost-btn:hover .arrow-wrapper { width: 16px; margin-right: 10px; opacity: 1; transform: translateX(0); }

        @keyframes fadeInZoom { from { opacity: 0; transform: scale(0.95); filter: blur(10px); } to { opacity: 1; transform: scale(1); filter: blur(0); } }
        @keyframes pulse { 0% { transform: scale(1); opacity: 1; } 50% { transform: scale(1.3); opacity: 0.6; } 100% { transform: scale(1); opacity: 1; } }
        @keyframes ripple { 0% { transform: translate(-50%, -50%) scale(1); opacity: 0.8; } 100% { transform: translate(-50%, -50%) scale(2.5); opacity: 0; } }
        @keyframes scan { 0% { top: 0%; opacity: 0; } 10% { opacity: 1; } 90% { opacity: 1; } 100% { top: 100%; opacity: 0; } }

        @media (max-width: 768px) {
            h1 { font-size: 1.2rem; }
            .header-ui { top: 40px; }
            .footer-nav { bottom: 40px; }
        }
    </style>
</head>
<body>

    <div id="main-wrapper">
        <div class="layer-bg">
            <svg class="sketch-grid">
                <line x1="10%" y1="0" x2="10%" y2="100%" class="grid-line"></line>
                <line x1="90%" y1="0" x2="90%" y2="100%" class="grid-line"></line>
                <line x1="0" y1="20%" x2="100%" y2="20%" class="grid-line"></line>
                <line x1="0" y1="80%" x2="100%" y2="80%" class="grid-line"></line>
            </svg>
        </div>

        <div class="header-ui">
            <h1>ç›®æ ‡é”å®š</h1>
            <div class="sub-text">WUHAN / 30.48Â°N, 114.40Â°E</div>
        </div>

        <div class="controls-hint">SCROLL TO ZOOM / DRAG TO MOVE</div>

        <div class="map-container" id="mapContainer">
            <div class="scan-line"></div>
            
            <div class="map-movable-layer" id="mapLayer">
                <img src="https://raw.githubusercontent.com/PikaQuC/shoujv.github.io/main/image/wuhanmap.png" class="map-image" id="targetMap">
                <div class="map-pin pin-bistro">
                    <div class="pin-dot"></div>
                    <div class="pin-label">åŠç›è¯—å°é…’é¦†</div>
                </div>
            </div>
        </div>

        <div class="footer-nav">
            <a href="gallery.html" class="ghost-btn">
                <span>è¿”å›çº¿ç´¢æ¿</span>
                <span class="arrow-wrapper">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <line x1="19" y1="12" x2="5" y2="12"></line>
                        <polyline points="12 19 5 12 12 5"></polyline>
                    </svg>
                </span>
            </a>
        </div>
    </div>

    <script>
        const linkBtn = document.querySelector('.ghost-btn');
        const container = document.getElementById('mapContainer');
        const mapLayer = document.getElementById('mapLayer');
        const mapImg = document.getElementById('targetMap');

        linkBtn.addEventListener('click', function(e) {
            e.preventDefault();
            document.body.classList.add('is-exiting');
            setTimeout(() => { window.location.href = this.href; }, 800);
        });

        // ==========================================
        // ğŸ—ºï¸ å¼ºåˆ¶ 1:1 çºµæ¨ªæ¯”é”å®š
        // ==========================================

        let state = {
            scale: 1, panning: false, pointX: 0, pointY: 0, startX: 0, startY: 0, x: 0, y: 0, baseSize: 0
        };

        function initMap() {
            const cw = container.clientWidth;
            const ch = container.clientHeight;
            
            // ğŸ”¥ğŸ”¥ æ ¸å¿ƒä¿®æ­£ 2ï¼šå†™æ­» 1:1 æ¯”ä¾‹ ğŸ”¥ğŸ”¥
            // å› ä¸ºä½ çš„å›¾æ˜¯ 5000x5000ï¼Œæˆ‘ä»¬ä¸å†ä¾èµ– img loading çŠ¶æ€
            // æˆ‘ä»¬ç›´æ¥æ¯”è¾ƒ å±å¹•å®½ vs å±å¹•é«˜
            
            // é€»è¾‘ï¼šè°å¤§ç”¨è°ï¼Œç¡®ä¿å¡«æ»¡ (Cover)
            const maxSize = Math.max(cw, ch);
            
            // å¼ºåˆ¶å›¾å±‚ä¸ºæ­£æ–¹å½¢
            state.baseSize = maxSize;
            mapLayer.style.width = `${state.baseSize}px`;
            mapLayer.style.height = `${state.baseSize}px`;

            state.scale = 1;
            
            // å±…ä¸­
            state.x = (cw - state.baseSize) / 2;
            state.y = (ch - state.baseSize) / 2;

            updateTransform();
        }

        function updateTransform() {
            const cw = container.clientWidth;
            const ch = container.clientHeight;
            const currentSize = state.baseSize * state.scale;

            // X è½´é™åˆ¶
            if (currentSize <= cw) {
                state.x = (cw - currentSize) / 2;
            } else {
                const minX = cw - currentSize;
                const maxX = 0;
                if (state.x < minX) state.x = minX;
                if (state.x > maxX) state.x = maxX;
            }

            // Y è½´é™åˆ¶
            if (currentSize <= ch) {
                state.y = (ch - currentSize) / 2;
            } else {
                const minY = ch - currentSize;
                const maxY = 0;
                if (state.y < minY) state.y = minY;
                if (state.y > maxY) state.y = maxY;
            }

            mapLayer.style.transform = `translate(${state.x}px, ${state.y}px) scale(${state.scale})`;
        }

        container.addEventListener('wheel', (e) => {
            e.preventDefault();
            const rect = container.getBoundingClientRect();
            const xs = (e.clientX - rect.left - state.x) / state.scale;
            const ys = (e.clientY - rect.top - state.y) / state.scale;
            const factor = e.deltaY > 0 ? 0.9 : 1.1;
            let newScale = state.scale * factor;
            if (newScale < 1) newScale = 1; 
            if (newScale > 8) newScale = 8; 
            state.x -= xs * (newScale - state.scale);
            state.y -= ys * (newScale - state.scale);
            state.scale = newScale;
            updateTransform();
        }, { passive: false });

        function onPointerDown(e) {
            e.preventDefault(); 
            state.panning = true;
            state.pointX = e.clientX || e.touches[0].clientX;
            state.pointY = e.clientY || e.touches[0].clientY;
            state.startX = state.x;
            state.startY = state.y;
            mapLayer.style.cursor = 'grabbing';
        }

        function onPointerMove(e) {
            if (!state.panning) return;
            e.preventDefault();
            const cx = e.clientX || e.touches[0].clientX;
            const cy = e.clientY || e.touches[0].clientY;
            state.x = state.startX + (cx - state.pointX);
            state.y = state.startY + (cy - state.pointY);
            updateTransform();
        }

        function onPointerUp() {
            state.panning = false;
            mapLayer.style.cursor = 'crosshair';
        }

        container.addEventListener('mousedown', onPointerDown);
        container.addEventListener('touchstart', onPointerDown, { passive: false });
        window.addEventListener('mousemove', onPointerMove);
        window.addEventListener('touchmove', onPointerMove, { passive: false });
        window.addEventListener('mouseup', onPointerUp);
        window.addEventListener('touchend', onPointerUp);

        // åˆå§‹åŒ–
        window.addEventListener('resize', initMap);
        setTimeout(initMap, 100); 

    </script>
</body>
</html>
